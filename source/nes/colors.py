from typing import List, Tuple

Color = Tuple[int, int, int]

Colors = List[Color]

COLORS_2C02: Colors = [
    (0x62, 0x62, 0x62),  # $00
    (0x00, 0x1f, 0xb2),  # $01
    (0x24, 0x04, 0xc8),  # $02
    (0x52, 0x00, 0xb2),  # $03
    (0x24, 0x44, 0x00),  # $04
    (0x80, 0x00, 0x24),  # $05
    (0x73, 0x0b, 0x00),  # $06
    (0x52, 0x28, 0x00),  # $07
    (0x24, 0x44, 0x00),  # $08
    (0x00, 0x57, 0x00),  # $09
    (0x00, 0x5c, 0x00),  # $0A
    (0x00, 0x53, 0x24),  # $0B
    (0x00, 0x3c, 0x76),  # $0C
    (0x00, 0x00, 0x00),  # $0D
    (0x00, 0x00, 0x00),  # $0E
    (0x00, 0x00, 0x00),  # $0F

    (0xab, 0xab, 0xab),  # $10
    (0x0d, 0x57, 0xff),  # $11
    (0x4b, 0x30, 0xff),  # $12
    (0x8a, 0x13, 0xff),  # $13
    (0xbc, 0x08, 0xd6),  # $14
    (0xd2, 0x12, 0x69),  # $15
    (0xc7, 0x2e, 0x00),  # $16
    (0x9d, 0x54, 0x00),  # $17
    (0x60, 0x7b, 0x00),  # $18
    (0x20, 0x98, 0x00),  # $19
    (0x00, 0xa3, 0x00),  # $1A
    (0x00, 0x99, 0x42),  # $1B
    (0x00, 0x7d, 0xb4),  # $1C
    (0x00, 0x00, 0x00),  # $1D
    (0x00, 0x00, 0x00),  # $1E
    (0x00, 0x00, 0x00),  # $1F

    (0xff, 0xff, 0xff),  # $20
    (0x53, 0xae, 0xff),  # $21
    (0x90, 0x85, 0xff),  # $22
    (0xd3, 0x65, 0xff),  # $23
    (0xff, 0x57, 0xff),  # $24
    (0xff, 0x5d, 0xcf),  # $25
    (0xff, 0x77, 0x57),  # $26
    (0xfa, 0x9e, 0x00),  # $27
    (0xbd, 0xc7, 0x00),  # $28
    (0x7a, 0xe7, 0x00),  # $29
    (0x43, 0xf6, 0x11),  # $2A
    (0x26, 0xef, 0x7e),  # $2B
    (0x2c, 0xd5, 0xf6),  # $2C
    (0x4e, 0x4e, 0x4e),  # $2D
    (0x00, 0x00, 0x00),  # $2E
    (0x00, 0x00, 0x00),  # $2F

    (0xff, 0xff, 0xff),  # $30
    (0xb6, 0xe1, 0xff),  # $31
    (0xce, 0xd1, 0xff),  # $32
    (0xe9, 0xc3, 0xff),  # $33
    (0xff, 0xbc, 0xff),  # $34
    (0xff, 0xbc, 0xff),  # $35
    (0xff, 0xc6, 0xc3),  # $36
    (0xff, 0xd5, 0x9a),  # $37
    (0xe9, 0xe6, 0x81),  # $38
    (0xce, 0xf4, 0x81),  # $39
    (0xce, 0xf4, 0x81),  # $3A
    (0xa9, 0xfa, 0xc3),  # $3B
    (0xa9, 0xf0, 0xf4),  # $3C
    (0xb8, 0xb8, 0xb8),  # $3D
    (0x00, 0x00, 0x00),  # $3E
    (0x00, 0x00, 0x00),  # $3F
]

CANONICAL_BLACK_COLOR_INDEX = 0x0f


def find_closest_color_index(color: Color, palette: Colors = None) -> int:
    """
    Return index of the nes color that is closest to the given color.
    """
    if palette is None:
        palette = COLORS_2C02

    try:
        index = palette.index(color[0:3])

        if index in [0x0d, 0x0e, 0x1d, 0x1e, 0x1f, 0x2e, 0x2f, 0x3e, 0x3f]:
            index = CANONICAL_BLACK_COLOR_INDEX

        return index
    except ValueError:
        # No exact color match. Find closest.
        pass

    return 0
